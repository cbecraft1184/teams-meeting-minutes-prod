christopher [ ~/TeamsMeetingDemo ]$ cd ~/TeamsMeetingDemo

# 1. Update package.json - upgrade problematic packages
npm pkg set devDependencies.tsx="^4.20.5"
npm pkg set devDependencies.vite="^5.4.12"
npm pkg set devDependencies.drizzle-kit="^0.31.4"

# 2. Delete old lockfile and regenerate with fixes
rm -f package-lock.json
npm cache clean --force
npm install

# 3. Fix vulnerabilities properly
npm audit fix

# 4. Update browserslist database
npx update-browserslist-db@latest

# 5. Verify all warnings are gone
npm audit

# 6. Update Dockerfile to use npm 11.6.3
cat > Dockerfile << 'EOF'
FROM node:20-alpine AS builder
WORKDIR /app
RUN apk add --no-cache python3 make g++
RUN npm install -g npm@11.6.3
COPY package*.json ./
RUN npm ci
RUN npx update-browserslist-db@latest
COPY . .
RUN node scripts/build-server.mjs

FROM node:20-alpine
WORKDIR /app
RUN apk add --no-cache curl ca-certificates python3 make g++
RUN npm install -g npm@11.6.3
COPY package*.json ./
RUN npm ci --include=optional --omit=dev
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/shared ./shared
COPY --from=builder /app/server ./server
COPY --from=builder /app/drizzle.config.ts ./drizzle.config.ts
sleep 90 && curl -I https://teams-minutes-app.orangemushroom-b6a1517d.eastus2.azurecontainerapps.io/healthacr.azurecr.io/teams-minutes:latest
npm warn using --force Recommended protections disabled.

up to date, audited 717 packages in 3s

96 packages are looking for funding
  run `npm fund` for details

9 vulnerabilities (3 low, 5 moderate, 1 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

changed 6 packages, and audited 717 packages in 4s

96 packages are looking for funding
  run `npm fund` for details

# npm audit report

esbuild  <=0.24.2
Severity: moderate
esbuild enables any website to send any requests to the development server and read the response - https://github.com/advisories/GHSA-67mh-4wv8-2f99
fix available via `npm audit fix --force`
Will install vite@7.2.4, which is a breaking change
node_modules/@esbuild-kit/core-utils/node_modules/esbuild
node_modules/vite/node_modules/esbuild
  @esbuild-kit/core-utils  *
  Depends on vulnerable versions of esbuild
  node_modules/@esbuild-kit/core-utils
    @esbuild-kit/esm-loader  *
    Depends on vulnerable versions of @esbuild-kit/core-utils
    node_modules/@esbuild-kit/esm-loader
      drizzle-kit  0.17.5-6b7793f - 0.17.5-e5944eb || 0.18.1-065de38 - 0.18.1-f3800bf || >=0.19.0-07024c4
      Depends on vulnerable versions of @esbuild-kit/esm-loader
      node_modules/drizzle-kit
  vite  0.11.0 - 6.1.6
  Depends on vulnerable versions of esbuild
  node_modules/vite

5 moderate severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force
Need to install the following packages:
update-browserslist-db@1.1.4
Ok to proceed? (y) Y

Latest version:     1.0.30001757
Installed version:  1.0.30001677
Removing old caniuse-lite from lock file
Installing new caniuse-lite version
$ npm install caniuse-lite
Cleaning package.json dependencies from caniuse-lite
$ npm uninstall caniuse-lite
caniuse-lite has been successfully updated

No target browser changes
# npm audit report

esbuild  <=0.24.2
Severity: moderate
esbuild enables any website to send any requests to the development server and read the response - https://github.com/advisories/GHSA-67mh-4wv8-2f99
fix available via `npm audit fix --force`
Will install vite@7.2.4, which is a breaking change
node_modules/@esbuild-kit/core-utils/node_modules/esbuild
node_modules/vite/node_modules/esbuild
  @esbuild-kit/core-utils  *
  Depends on vulnerable versions of esbuild
  node_modules/@esbuild-kit/core-utils
    @esbuild-kit/esm-loader  *
    Depends on vulnerable versions of @esbuild-kit/core-utils
    node_modules/@esbuild-kit/esm-loader
      drizzle-kit  0.17.5-6b7793f - 0.17.5-e5944eb || 0.18.1-065de38 - 0.18.1-f3800bf || >=0.19.0-07024c4
      Depends on vulnerable versions of @esbuild-kit/esm-loader
      node_modules/drizzle-kit
  vite  0.11.0 - 6.1.6
  Depends on vulnerable versions of esbuild
  node_modules/vite

5 moderate severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force
Packing source code into tar to upload...
Excluding '.gitignore' based on default ignore rules
Excluding '.git' based on default ignore rules
Uploading archived source code from '/tmp/build_archive_295466e00816446fb42a596294902662.tar.gz'...
Sending context (252.907 MiB) to registry: teamminutesacr...
Queued a build with ID: chm
Waiting for an agent...
2025/11/24 21:07:57 Downloading source code..